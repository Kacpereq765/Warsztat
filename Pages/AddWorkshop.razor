@page "/AddWorkshop"
@using MudBlazor
@using Blazored.LocalStorage
@inject NavigationManager NavigationManager
@inject ILocalStorageService localStorage

<h3>Dodaj warsztat</h3>

<MudContainer>
    <MudCard>
        <MudCardContent>
            <MudForm @ref="form" Model="workshop" Validations="null">
                <MudTextField @bind-Value="workshop.NameWorkshop" Label="Nazwa warsztatu" Required="true" />
                <MudTextField @bind-Value="workshop.Description" Label="Opis warsztatu" Required="true" />
                <MudTextField @bind-Value="workshop.Location" Label="Lokalizacja warsztatu" Required="true" />
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SubmitForm">Dodaj warsztat</MudButton>
            </MudForm>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Return">Powrót</MudButton>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private Workshop workshop = new();
    private MudForm form;

    private async Task SubmitForm()
    {
        if (form.IsValid)
        {
            Console.WriteLine($"Dodano warsztat: {workshop.NameWorkshop}, Opis: {workshop.Description}, Lokalizacja: {workshop.Location}");

            await SaveWorkshopToLocalStorage(workshop); 

            NavigationManager.NavigateTo("/ViewWorkshop");
        }
        else
        {
            Console.WriteLine("Formularz nie jest ważny.");
        }
    }

    private async Task Return()
    {
        NavigationManager.NavigateTo("/ViewWorkshop");
    }

    private async Task SaveWorkshopToLocalStorage(Workshop workshop)
    {
        // Wczytanie istniejących warsztatów
        var workshops = await localStorage.GetItemAsync<List<Workshop>>("workshops") ?? new List<Workshop>();

        // Dodanie nowego warsztatu
        workshops.Add(workshop);

        // Zapis do localStorage
        await localStorage.SetItemAsync("workshops", workshops);
        Console.WriteLine("Dodano warsztat do localStorage");
    }

    public class Workshop
    {
        public string NameWorkshop { get; set; }
        public string Description { get; set; }
        public string Location { get; set; }
    }
}
